if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")
BiocManager::install(c("airway", "DESeq2", "EnhancedVolcano"))
# load data ----------
data("airway")
# Load libraries
library(airway)
library(DESeq2)
# load data ----------
data("airway")
airway$dex <- relevel(airway$dex, ref = "untrt")  # Set control group as reference
dds <- DESeqDataSet(airway, design = ~ dex)
dds <- DESeq(dds)
res <- results(dds)
View(res)
writexl::write_xlsx(res, paste0("DESeq2_data.xlsx"))
res <- results(dds) |>
as.data.frame() |>
setDT(keep.rownames = "GeneID")
library(data.table)
res <- results(dds) |>
as.data.frame() |>
setDT(keep.rownames = "GeneID")
df = res[which( !is.na(res$pvalue) )]
df$y = -log10(df$pvalue)
df$ann = ifelse(
df$pvalue > .05, "Not significant",
ifelse(
df$log2FoldChange > 0, "Up regulated", "Down regulated"
)
)
df$ann = ifelse(
df$pvalue <= 0.05 & df$log2FoldChange > -1 & df$log2FoldChange < 1,
paste0(df$ann, " (low)"),
df$ann
)
df2 = df[which(pvalue <= .05 & abs(log2FoldChange) > 1)]
df2 = df2[order( abs(log2FoldChange), decreasing = TRUE )]
df2 = df2[, by = ann, head(.SD, 10) ]
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf, # label.size = NA, fill = "transparent",
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
# scale_x_continuous(trans = scales::pseudo_log_trans()) +
scale_x_continuous(
#limits = c(-10, 5),
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal() +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
ggplot(data = df)
library(ggplot2)
library(dplyr)
library(stringr)
library(data.table)
library(ggtext)
library(extrafont)
library(ggstream)
library(colorspace)
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf, # label.size = NA, fill = "transparent",
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
# scale_x_continuous(trans = scales::pseudo_log_trans()) +
scale_x_continuous(
#limits = c(-10, 5),
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal() +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white")
library(data.table)
library(stringr)
library(ggplot2)
library(ggrepel)
library(colorspace)
library(ggplot2)
library(shadowtext)
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf, # label.size = NA, fill = "transparent",
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
# scale_x_continuous(trans = scales::pseudo_log_trans()) +
scale_x_continuous(
#limits = c(-10, 5),
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal() +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf,
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
scale_x_continuous(
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40)
# trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal() +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf,
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
scale_x_continuous(
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal() +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf,
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
scale_x_continuous(
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal(base_family = "Candara") +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf,
fontface = "bold", size = 2,5, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
scale_x_continuous(
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal(base_family = "Candara") +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
df2 = df[which(pvalue <= .05 & abs(log2FoldChange) > 1)]
df2 = df2[order( abs(log2FoldChange), decreasing = TRUE )]
df2 = df2[, by = ann, head(.SD, 5) ]
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf,
fontface = "bold", size = 2,5, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
scale_x_continuous(
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal(base_family = "Candara") +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
gr = ggplot(data = df) +
geom_point(aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = NA, size = 2, alpha = .5) +
geom_vline(xintercept = c(-1, 1), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_hline(yintercept = -log10(.05), linewidth = .3, linetype = "dashed", lineend = "round") +
geom_point(data = df2, aes(x = log2FoldChange, y = -log10(pvalue), fill = ann),
shape = 21, stroke = .15, size = 2, color = "white") +
geom_text_repel(
data = df2, aes(x = log2FoldChange, y = -log10(pvalue), label = GeneID),
max.overlaps = Inf,
fontface = "bold", size = 3, bg.color = "white", bg.r = .05
) +
scale_fill_manual(
values = c(
"Up regulated" = "#990000",
"Up regulated (low)" = lighten("#990000", .5),
"Down regulated" = "#004d99",
"Down regulated (low)" = lighten("#004d99", .5),
"Not significant" = "grey"
),
breaks = c("Up regulated", "Not significant", "Down regulated"),
guide = guide_legend(
override.aes = list(size = 3, alpha = 1)
),
) +
scale_x_continuous(
breaks = c(-5, -2.5, -1, 0, 1, 2.5, 5),
trans = scales::pseudo_log_trans()
) +
scale_y_continuous(
expand = c(0, 0), breaks = c(2, 5, 10, 20, 30, 40),
trans = scales::pseudo_log_trans()
) +
coord_cartesian(clip = "off") +
theme_minimal(base_family = "Candara") +
theme(
legend.title = element_blank(),
legend.position = "bottom",
axis.line = element_line(linewidth = .3, color = "black"),
axis.ticks = element_line(linewidth = .3, color = "black"),
panel.grid.minor = element_blank(),
panel.grid.major = element_line(linewidth = .3, linetype = "dashed", color = "grey85"),
plot.margin = margin(20, 20, 20, 20),
) +
labs(y = "-log10(pvalue)", x = "log2(Fold Change)")
gr
